# Kuberenets Monitoring and Init Containers

## Explanation of Compoenents

Prometheus Operator: Streamlines the deployment of a Prometheus stack to a Kubernetes cluster.

Prometheus: Handles application metrics collection and storage.

Alertmanager: Manages the alerts generated by Prometheus and directs them to predefined channels such as email or Telegram.

Prometheus Node Exporter: Collects hardware and OS metrics for Prometheus.

Prometheus Blackbox Exporter: Probes endpoints over HTTP, HTTPS, DNS, TCP, and ICMP to test service availability.

Prometheus Adapter for Kubernetes Metrics APIs: Gathers metrics from Kubernetes and provides them for Prometheus.

kube-state-metrics: A service that monitors the Kubernetes API server and produces metrics about object states for Prometheus.

Grafana: Assists in data visualization through dashboards.

## Helm Charts and Installation

Let's consider the output of the following command:

```
kubectl get po,sts,svc,pvc,cm
```

First section is a list of pods currently running in the cluster:

```
NAME                                                         READY   STATUS      RESTARTS   AGE
pod/alertmanager-kbs-app-kube-prometheus-st-alertmanager-0   2/2     Running     0          13m
pod/app-python-helm-app-python-0                             0/1     Running     0          52s
pod/app-python-helm-app-python-1                             0/1     Running     0          52s
pod/kbs-app-grafana-86f7cc9d4f-8xkgd                         3/3     Running     0          16m
pod/kbs-app-kube-prometheus-st-operator-6f75cf5c58-9dh4d     1/1     Running     0          16m
pod/kbs-app-kube-state-metrics-6cd5db7bb4-zlxxd              1/1     Running     0          16m
pod/kbs-app-prometheus-node-exporter-t4qdq                   1/1     Running     0          16m
pod/postinstall-hook                                         0/1     Completed   0          8m36s
pod/prometheus-kbs-app-kube-prometheus-st-prometheus-0       2/2     Running     0          13m
```

Second section is a list of stateful sets with their status and age:

```
NAME                                                                    READY   AGE
statefulset.apps/alertmanager-kbs-app-kube-prometheus-st-alertmanager   1/1     15m
statefulset.apps/app-python-helm-app-python                             2/2     2m51s
statefulset.apps/prometheus-kbs-app-kube-prometheus-st-prometheus       1/1     15m
```

Third section is a list of services with their cluster IPs and ports:

```
NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   15m
service/app-python-helm-app-python                LoadBalancer   10.100.148.97    <pending>     5000:32275/TCP               2m51s
service/kbs-app-grafana                           ClusterIP      10.103.252.133   <none>        80/TCP                       18m
service/kbs-app-kube-prometheus-st-alertmanager   ClusterIP      10.101.129.19    <none>        9093/TCP,8080/TCP            18m
service/kbs-app-kube-prometheus-st-operator       ClusterIP      10.109.96.126    <none>        443/TCP                      18m
service/kbs-app-kube-prometheus-st-prometheus     ClusterIP      10.99.15.253     <none>        9090/TCP,8080/TCP            18m
service/kbs-app-kube-state-metrics                ClusterIP      10.97.220.153    <none>        8080/TCP                     18m
service/kbs-app-prometheus-node-exporter          ClusterIP      10.100.63.231    <none>        9100/TCP                     18m
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      21d
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     15m
```

Fourth section is a list of persistent volume claims with their capacity and storage class. All of them are created by my app:

```
NAME                                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/data-app-python-helm-app-python-0   Bound    pvc-28166637-beba-48a9-9ca3-c155c6a5ba73   1Mi        RWO            standard       7d
persistentvolumeclaim/data-app-python-helm-app-python-1   Bound    pvc-4c4373cf-e822-463b-808e-9a1f507c8d0e   1Mi        RWO            standard       7d
```

Fifth section is a list of config maps with their data and age. The first one is mine, the others are from the Prometheus stack:

```
NAME                                                                     DATA   AGE
configmap/config                                                         1      2m51s
configmap/kbs-app-grafana                                                1      18m
configmap/kbs-app-grafana-config-dashboards                              1      18m
configmap/kbs-app-kube-prometheus-st-alertmanager-overview               1      18m
configmap/kbs-app-kube-prometheus-st-apiserver                           1      18m
configmap/kbs-app-kube-prometheus-st-cluster-total                       1      18m
configmap/kbs-app-kube-prometheus-st-controller-manager                  1      18m
configmap/kbs-app-kube-prometheus-st-etcd                                1      18m
configmap/kbs-app-kube-prometheus-st-grafana-datasource                  1      18m
configmap/kbs-app-kube-prometheus-st-grafana-overview                    1      18m
configmap/kbs-app-kube-prometheus-st-k8s-coredns                         1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-cluster               1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-multicluster          1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-namespace             1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-node                  1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-pod                   1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-workload              1      18m
configmap/kbs-app-kube-prometheus-st-k8s-resources-workloads-namespace   1      18m
configmap/kbs-app-kube-prometheus-st-kubelet                             1      18m
configmap/kbs-app-kube-prometheus-st-namespace-by-pod                    1      18m
configmap/kbs-app-kube-prometheus-st-namespace-by-workload               1      18m
configmap/kbs-app-kube-prometheus-st-node-cluster-rsrc-use               1      18m
configmap/kbs-app-kube-prometheus-st-node-rsrc-use                       1      18m
configmap/kbs-app-kube-prometheus-st-nodes                               1      18m
configmap/kbs-app-kube-prometheus-st-nodes-darwin                        1      18m
configmap/kbs-app-kube-prometheus-st-persistentvolumesusage              1      18m
configmap/kbs-app-kube-prometheus-st-pod-total                           1      18m
configmap/kbs-app-kube-prometheus-st-prometheus                          1      18m
configmap/kbs-app-kube-prometheus-st-proxy                               1      18m
configmap/kbs-app-kube-prometheus-st-scheduler                           1      18m
configmap/kbs-app-kube-prometheus-st-workload-total                      1      18m
configmap/kube-root-ca.crt                                               1      21d
configmap/prometheus-kbs-app-kube-prometheus-st-prometheus-rulefiles-0   35     15m
```

# Information about cluster

For Some Reason i am not able to access the Grafana Dashboard outside of the minikube cluster. I have followed all the steps mentioned in the DevOps group regarding this but still not able to figure out the issue.

# Init Containers

```
tanmay@tanmay-ubuntu:~/Tanmay/Courses/Devops/S24-core-course-labs/k8s$ kubectl exec helm-app-python-1 -- cat /work-dir/index.html
Defaulted container "helm-app-python" out of: helm-app-python, install (init)
<!doctype html>
<html>
<head>
    <title>Example Domain</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type="text/css">
    body {
        background-color: #f0f0f2;
        margin: 0;
        padding: 0;
        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
        
    }
    div {
        width: 600px;
        margin: 5em auto;
        padding: 2em;
        background-color: #fdfdff;
        border-radius: 0.5em;
        box-shadow: 2px 3px 7px 2px rgba(0,0,0,0.02);
    }
    a:link, a:visited {
        color: #38488f;
        text-decoration: none;
    }
    @media (max-width: 700px) {
        div {
            margin: 0 auto;
            width: auto;
        }
    }
    </style>    
</head>

<body>
<div>
    <h1>Example Domain</h1>
    <p>This domain is for use in illustrative examples in documents. You may use this
    domain in literature without prior coordination or asking for permission.</p>
    <p><a href="https://www.iana.org/domains/example">More information...</a></p>
</div>
</body>
</html>
```

# Bonus App Metrics

Same Reason, not working outside of minikube cluster for some unknown reason.

# Bonus Init Container Queue

```
tanmay@tanmay-ubuntu:~/Tanmay/Courses/Devops/S24-core-course-labs/k8s$ kubectl exec helm-app-python-1 -- cat /work-dir/lines.txt
Defaulted container "helm-app-python" out of: helm-app-python, install (init), line1 (init), line2 (init)
line1
line2
tanmay@tanmay-ubuntu:~/Tanmay/Courses/Devops/S24-core-course-labs/k8s$ 
```


